<!DOCTYPE html>
<html>
<head>
  <title>Color Game</title>
  <style>
    body {
      background: #111;
      color: white;
      text-align: center;
      font-family: sans-serif;
    }

    .dice {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 20px;
    }

    .dice div {
      width: 100px;
      height: 100px;
      font-size: 20px;
      border: 2px solid #fff;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.5s ease, background 0.3s, filter 0.3s, opacity 0.3s;
    }

    .rolling {
      transform: scale(0.3) rotate(720deg);
      filter: blur(3px);
      opacity: 0.3;
    }

    button {
      padding: 10px 20px;
      font-size: 18px;
      margin-top: 20px;
      background: #28a745;
      border: none;
      color: white;
      border-radius: 8px;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>
</head>
<body>
  <h1>ðŸŽ² Color Game</h1>

  <div class="dice">
    <div id="dice1">?</div>
    <div id="dice2">?</div>
    <div id="dice3">?</div>
  </div>

  <button onclick="rollDice()">ROLL</button>

  <!-- ðŸ”Š Dice Roll Sound -->
  <audio id="rollSound" preload="auto" playsinline>
    <source src="https://cdn.pixabay.com/audio/2022/03/15/audio_8889c15e44.mp3" type="audio/mpeg">
  </audio>

  <script>
    // âœ… Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCX6bXyHJEdUFSZTq2tBqFYFYNv7FSxD8",
      authDomain: "color-game-135fb.firebaseapp.com",
      databaseURL: "https://color-game-135fb-default-rtdb.firebaseio.com",
      projectId: "color-game-135fb",
      storageBucket: "color-game-135fb.appspot.com",
      messagingSenderId: "362417900313",
      appId: "1:362417900313:web:765a79e4c95fa17936fa30"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const presetRef = db.ref('presetDice');

    const diceEls = [
      document.getElementById("dice1"),
      document.getElementById("dice2"),
      document.getElementById("dice3")
    ];

    const colors = ["Red", "Blue", "Green", "Yellow", "White", "Violet"];
    const colorMap = {
      Red: "#ff4d4d",
      Blue: "#4da6ff",
      Green: "#4dff88",
      Yellow: "#ffff4d",
      White: "#ffffff",
      Violet: "#c77dff"
    };

    let rigged = null;

    // Watch for preset
    presetRef.on('value', snapshot => {
      rigged = snapshot.val();
    });

    function rollDice() {
      const sound = document.getElementById("rollSound");
      if (sound) {
        sound.pause();
        sound.currentTime = 0;
        sound.play().catch(e => console.log("Sound blocked:", e));
      }

      // Animate dice roll
      diceEls.forEach(el => {
        el.classList.add("rolling");
        el.textContent = "?";
        el.style.background = "#333";
        el.style.color = "#fff";
      });

      setTimeout(() => {
        const result = rigged || [
          colors[Math.floor(Math.random() * 6)],
          colors[Math.floor(Math.random() * 6)],
          colors[Math.floor(Math.random() * 6)]
        ];

        diceEls.forEach((el, i) => {
          const color = result[i] || "?";
          el.textContent = color;
          el.style.background = colorMap[color] || "#555";
          el.style.color = color === "White" ? "#000" : "#fff";
          el.classList.remove("rolling");
        });

        presetRef.set(null); // Clear rig
      }, 600);
    }
  </script>
</body>
</html>
